- hosts: [nodes]
  remote_user: duboc_au
  tasks:
  - name: "get last bytes ipv4 ip address"
    shell:  echo $(ip a | grep -E -o "([0-9]{1,3}[\.]){3}[0-9]{1,3}" | grep "157.159" | head -n 1 | cut -d'.' -f4)
    register: num

  - name: "get virtual machine name"
    shell:  echo {{num}}
    register: name

  - debug: 
       var: name

  - name: "get ram"
    shell:  echo $(free -m | tail -n 2 | head -n 1 | awk '{print $2}')
    register: ram
  
  - name: "get cpu"
    shell: echo $(( $(lscpu | grep Proces | awk '{print $2}') * $(lscpu | grep Thread | cut -d':' -f2 | awk '{print $1}') ))
    register: cpu
